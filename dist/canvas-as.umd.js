!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("assemblyscript/lib/loader")):"function"==typeof define&&define.amd?define(["exports","assemblyscript/lib/loader"],e):e(t.canvasAs={},t.loader)}(this,function(t,e){"use strict";var i,r,a,n,s,o,c,h,l;!function(t){t[t.ltr=0]="ltr",t[t.rtl=1]="rtl",t[t.inherit=2]="inherit"}(i||(i={})),function(t){t[t.nonzero=0]="nonzero",t[t.evenodd=1]="evenodd"}(r||(r={})),function(t){t[t.source_over=0]="source_over",t[t.source_in=1]="source_in",t[t.source_out=2]="source_out",t[t.source_atop=3]="source_atop",t[t.destination_over=4]="destination_over",t[t.destination_in=5]="destination_in",t[t.destination_out=6]="destination_out",t[t.destination_atop=7]="destination_atop",t[t.lighter=8]="lighter",t[t.copy=9]="copy",t[t.xor=10]="xor",t[t.multiply=11]="multiply",t[t.screen=12]="screen",t[t.overlay=13]="overlay",t[t.darken=14]="darken",t[t.lighten=15]="lighten",t[t.color_dodge=16]="color_dodge",t[t.color_burn=17]="color_burn",t[t.hard_light=18]="hard_light",t[t.soft_light=19]="soft_light",t[t.difference=20]="difference",t[t.exclusion=21]="exclusion",t[t.hue=22]="hue",t[t.saturation=23]="saturation",t[t.color=24]="color",t[t.luminosity=25]="luminosity"}(a||(a={})),function(t){t[t.low=0]="low",t[t.medium=1]="medium",t[t.high=2]="high"}(n||(n={})),function(t){t[t.butt=0]="butt",t[t.round=1]="round",t[t.square=2]="square"}(s||(s={})),function(t){t[t.bevel=0]="bevel",t[t.round=1]="round",t[t.miter=2]="miter"}(o||(o={})),function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.center=2]="center",t[t.start=3]="start",t[t.end=4]="end"}(c||(c={})),function(t){t[t.top=0]="top",t[t.hanging=1]="hanging",t[t.middle=2]="middle",t[t.alphabetic=3]="alphabetic",t[t.ideographic=4]="ideographic",t[t.bottom=5]="bottom"}(h||(h={})),(l=t.GlobalCompositeOperationLookup||(t.GlobalCompositeOperationLookup={}))[l["source-over"]=0]="source-over",l[l["source-in"]=1]="source-in",l[l["source-out"]=2]="source-out",l[l["source-atop"]=3]="source-atop",l[l["destination-over"]=4]="destination-over",l[l["destination-in"]=5]="destination-in",l[l["destination-out"]=6]="destination-out",l[l["destination-atop"]=7]="destination-atop",l[l.lighter=8]="lighter",l[l.copy=9]="copy",l[l.xor=10]="xor",l[l.multiply=11]="multiply",l[l.screen=12]="screen",l[l.overlay=13]="overlay",l[l.darken=14]="darken",l[l.lighten=15]="lighten",l[l["color-dodge"]=16]="color-dodge",l[l["color-burn"]=17]="color-burn",l[l["hard-light"]=18]="hard-light",l[l["soft-light"]=19]="soft-light",l[l.difference=20]="difference",l[l.exclusion=21]="exclusion",l[l.hue=22]="hue",l[l.saturation=23]="saturation",l[l.color=24]="color",l[l.luminosity=25]="luminosity";var d={0:"repeat",1:"repeat-x",2:"repeat-y",3:"no-repeat"},u=function(t,e,i){this.strings=new Map,this.images={},this.patterns={},this.gradients={},this.wasm=null,this.image_loaded_internal=0,this.inject_internal=0,this.ctx=t,this.loaded=this.init(e,i)};u.prototype.injectImage=function(t,e){var i=this,r=this.wasm.newString(t);return e.then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t)}).then(function(t){return i.loaded.then(function(e){return t})}).then(function(t){var e=i.wasm.getFunction(i.inject_internal)(r),a=e/Int32Array.BYTES_PER_ELEMENT;i.images[i.wasm.I32[a]]=t,i.wasm.getFunction(i.image_loaded_internal)(e,t.width,t.height)}),this},u.prototype.init=function(t,i){void 0===i&&(i={});try{var r=this;return i.__as_interop={add_color_stop:r.add_color_stop.bind(r),create_image:r.create_image.bind(r),create_linear_gradient:r.create_linear_gradient.bind(r),create_pattern:r.create_pattern.bind(r),create_radial_gradient:r.create_radial_gradient.bind(r),create_string:r.create_string.bind(r),remove_image:r.remove_image.bind(r),remove_gradient:r.remove_gradient.bind(r),remove_pattern:r.remove_pattern.bind(r),report_inject_function:r.report_inject_function.bind(r)},Promise.resolve(e.instantiateStreaming(t,i)).then(function(t){r.wasm=t,r.wasm.init()})}catch(t){return Promise.reject(t)}},u.prototype.update=function(){this.wasm.update()},u.prototype.draw=function(){var t=this.wasm.getArray(Float64Array,this.wasm.draw());this.render(t)},u.prototype.render=function(e){for(var a=0,l=0;a<e.length;){if(6===e[a]){this.strings.clear();break}switch(l=e[a+1],e[a]){case 0:this.ctx.arc(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],1===e[a+7]);break;case 1:this.ctx.arcTo(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6]);break;case 2:this.ctx.beginPath();break;case 3:this.ctx.bezierCurveTo(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7]);break;case 7:this.ctx.clearRect(e[a+2],e[a+3],e[a+4],e[a+5]);break;case 4:this.ctx.clip();break;case 5:this.ctx.closePath();break;case 8:this.ctx.direction=i[e[a+2]];break;case 10:if(!this.images[e[a+2]])break;this.ctx.drawImage(this.images[e[a+2]],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7],e[a+8],e[a+9],e[a+10]);break;case 11:this.ctx.ellipse(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7],e[a+8],1===e[a+9]);break;case 12:this.ctx.fill(r[e[a+2]]);break;case 13:this.ctx.fillStyle=this.gradients[e[a+2]];break;case 14:this.ctx.fillStyle=this.patterns[e[a+2]];break;case 15:this.ctx.fillRect(e[a+2],e[a+3],e[a+4],e[a+5]);break;case 16:if(!this.strings.has(e[a+2]))continue;this.ctx.fillStyle=this.strings.get(e[a+2]);break;case 17:if(!this.strings.has(e[a+2]))continue;this.ctx.fillText(this.strings.get(e[a+2]),e[a+3],e[a+4],-1===e[a+5]?void 0:e[a+5]);break;case 18:if(!this.strings.has(e[a+2]))continue;this.ctx.filter=this.strings.get(e[a+2]);break;case 19:if(!this.strings.has(e[a+2]))continue;this.ctx.font=this.strings.get(e[a+2]);break;case 20:this.ctx.globalAlpha=e[a+2];break;case 21:this.ctx.globalCompositeOperation=t.GlobalCompositeOperationLookup[e[a+2]];break;case 22:this.ctx.imageSmoothingEnabled=1===e[a+2];break;case 23:this.ctx.imageSmoothingQuality=n[e[a+2]];break;case 24:this.ctx.lineCap=s[e[a+2]];break;case 25:this.ctx.setLineDash(this.wasm.getArray(Float64Array,e[a+2]));break;case 26:this.ctx.lineDashOffset=e[a+2];break;case 27:this.ctx.lineJoin=o[e[a+2]];break;case 28:this.ctx.lineTo(e[a+2],e[a+3]);break;case 29:this.ctx.lineWidth=e[a+2];break;case 30:this.ctx.miterLimit=e[a+2];break;case 31:this.ctx.moveTo(e[a+2],e[a+3]);break;case 32:this.ctx.quadraticCurveTo(e[a+2],e[a+3],e[a+4],e[a+5]);break;case 33:this.ctx.rect(e[a+2],e[a+3],e[a+4],e[a+5]);break;case 34:this.ctx.restore();break;case 35:this.ctx.rotate(e[a+2]);break;case 36:this.ctx.save();break;case 37:this.ctx.scale(e[a+2],e[a+3]);break;case 38:this.ctx.setTransform(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7]);break;case 39:this.ctx.shadowBlur=e[a+2];break;case 40:if(!this.strings.has(e[a+2]))continue;this.ctx.shadowColor=this.strings.get(e[a+2]);break;case 41:this.ctx.shadowOffsetX=e[a+2];break;case 42:this.ctx.shadowOffsetY=e[a+2];break;case 47:this.strings.has(e[a+2])||(this.ctx.fillStyle=this.strings.get(e[a+2]));break;case 44:this.ctx.strokeStyle=this.gradients[e[a+2]];break;case 45:this.ctx.strokeStyle=this.patterns[e[a+2]];break;case 49:this.ctx.textAlign=c[e[a+2]];break;case 50:this.ctx.textBaseline=h[e[a+2]];break;case 52:this.ctx.transform(e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7]);break;case 51:this.ctx.translate(e[a+2],e[a+3]);break;default:throw new Error("Invalid canvas instruction type: "+e[a])}a+=l}},u.prototype.add_color_stop=function(t,e,i){this.gradients[t].addColorStop(e,this.wasm.getString(i))},u.prototype.create_image=function(t,e){this.load_image(t,e)},u.prototype.create_linear_gradient=function(t,e,i,r,a){this.gradients[t]=this.ctx.createLinearGradient(e,i,r,a)},u.prototype.create_pattern=function(t,e,i){this.patterns[t]=this.ctx.createPattern(this.images[e],d[i])},u.prototype.create_radial_gradient=function(t,e,i,r,a,n,s){this.gradients[t]=this.ctx.createRadialGradient(e,i,r,a,n,s)},u.prototype.create_string=function(t,e){this.strings.set(t,this.wasm.getString(e))},u.prototype.remove_image=function(t){this.images[t]=null},u.prototype.remove_pattern=function(t){this.patterns[t]=null},u.prototype.remove_gradient=function(t){this.gradients[t]=null},u.prototype.load_image=function(t,e){try{var i=this,r=i.wasm.getString(e);return Promise.resolve(fetch(r)).then(function(e){return Promise.resolve(e.blob()).then(function(e){return Promise.resolve(createImageBitmap(e)).then(function(e){var r=t/Int32Array.BYTES_PER_ELEMENT;i.images[i.wasm.I32[r]]=e,i.wasm.getFunction(i.image_loaded_internal)(t,e.width,e.height)})})})}catch(t){return Promise.reject(t)}},u.prototype.report_inject_function=function(t,e){this.inject_internal=t,this.image_loaded_internal=e},t.CanvasASInterop=u,t.canvasPatternTypes=d});
//# sourceMappingURL=canvas-as.umd.js.map

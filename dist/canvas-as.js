"use strict";var t,e,i,r,a,s,n,o,c,h=require("assemblyscript/lib/loader");!function(t){t[t.ltr=0]="ltr",t[t.rtl=1]="rtl",t[t.inherit=2]="inherit"}(t||(t={})),function(t){t[t.nonzero=0]="nonzero",t[t.evenodd=1]="evenodd"}(e||(e={})),function(t){t[t.source_over=0]="source_over",t[t.source_in=1]="source_in",t[t.source_out=2]="source_out",t[t.source_atop=3]="source_atop",t[t.destination_over=4]="destination_over",t[t.destination_in=5]="destination_in",t[t.destination_out=6]="destination_out",t[t.destination_atop=7]="destination_atop",t[t.lighter=8]="lighter",t[t.copy=9]="copy",t[t.xor=10]="xor",t[t.multiply=11]="multiply",t[t.screen=12]="screen",t[t.overlay=13]="overlay",t[t.darken=14]="darken",t[t.lighten=15]="lighten",t[t.color_dodge=16]="color_dodge",t[t.color_burn=17]="color_burn",t[t.hard_light=18]="hard_light",t[t.soft_light=19]="soft_light",t[t.difference=20]="difference",t[t.exclusion=21]="exclusion",t[t.hue=22]="hue",t[t.saturation=23]="saturation",t[t.color=24]="color",t[t.luminosity=25]="luminosity"}(i||(i={})),function(t){t[t.low=0]="low",t[t.medium=1]="medium",t[t.high=2]="high"}(r||(r={})),function(t){t[t.butt=0]="butt",t[t.round=1]="round",t[t.square=2]="square"}(a||(a={})),function(t){t[t.bevel=0]="bevel",t[t.round=1]="round",t[t.miter=2]="miter"}(s||(s={})),function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.center=2]="center",t[t.start=3]="start",t[t.end=4]="end"}(n||(n={})),function(t){t[t.top=0]="top",t[t.hanging=1]="hanging",t[t.middle=2]="middle",t[t.alphabetic=3]="alphabetic",t[t.ideographic=4]="ideographic",t[t.bottom=5]="bottom"}(o||(o={})),(c=exports.GlobalCompositeOperationLookup||(exports.GlobalCompositeOperationLookup={}))[c["source-over"]=0]="source-over",c[c["source-in"]=1]="source-in",c[c["source-out"]=2]="source-out",c[c["source-atop"]=3]="source-atop",c[c["destination-over"]=4]="destination-over",c[c["destination-in"]=5]="destination-in",c[c["destination-out"]=6]="destination-out",c[c["destination-atop"]=7]="destination-atop",c[c.lighter=8]="lighter",c[c.copy=9]="copy",c[c.xor=10]="xor",c[c.multiply=11]="multiply",c[c.screen=12]="screen",c[c.overlay=13]="overlay",c[c.darken=14]="darken",c[c.lighten=15]="lighten",c[c["color-dodge"]=16]="color-dodge",c[c["color-burn"]=17]="color-burn",c[c["hard-light"]=18]="hard-light",c[c["soft-light"]=19]="soft-light",c[c.difference=20]="difference",c[c.exclusion=21]="exclusion",c[c.hue=22]="hue",c[c.saturation=23]="saturation",c[c.color=24]="color",c[c.luminosity=25]="luminosity";var l={0:"repeat",1:"repeat-x",2:"repeat-y",3:"no-repeat"},u=function(t,e,i){this.strings=new Map,this.images={},this.patterns={},this.gradients={},this.wasm=null,this.image_loaded_internal=0,this.inject_internal=0,this.ctx=t,this.loaded=this.init(e,i)};u.prototype.injectImage=function(t,e){var i=this,r=this.wasm.newString(t);return e.then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t)}).then(function(t){return i.loaded.then(function(e){return t})}).then(function(t){var e=i.wasm.getFunction(i.inject_internal)(r),a=e/Int32Array.BYTES_PER_ELEMENT;i.images[i.wasm.I32[a]]=t,i.wasm.getFunction(i.image_loaded_internal)(e,t.width,t.height)}),this},u.prototype.init=function(t,e){void 0===e&&(e={});try{var i=this;return e.__as_interop={add_color_stop:i.add_color_stop.bind(i),create_image:i.create_image.bind(i),create_linear_gradient:i.create_linear_gradient.bind(i),create_pattern:i.create_pattern.bind(i),create_radial_gradient:i.create_radial_gradient.bind(i),create_string:i.create_string.bind(i),remove_image:i.remove_image.bind(i),remove_gradient:i.remove_gradient.bind(i),remove_pattern:i.remove_pattern.bind(i),report_inject_function:i.report_inject_function.bind(i)},Promise.resolve(h.instantiateStreaming(t,e)).then(function(t){i.wasm=t,i.wasm.init()})}catch(t){return Promise.reject(t)}},u.prototype.update=function(){this.wasm.update()},u.prototype.draw=function(){var t=this.wasm.getArray(Float64Array,this.wasm.draw());this.render(t)},u.prototype.render=function(i){for(var c=0,h=0;c<i.length;){if(6===i[c]){this.strings.clear();break}switch(h=i[c+1],i[c]){case 0:this.ctx.arc(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6],1===i[c+7]);break;case 1:this.ctx.arcTo(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6]);break;case 2:this.ctx.beginPath();break;case 3:this.ctx.bezierCurveTo(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6],i[c+7]);break;case 7:this.ctx.clearRect(i[c+2],i[c+3],i[c+4],i[c+5]);break;case 4:this.ctx.clip();break;case 5:this.ctx.closePath();break;case 8:this.ctx.direction=t[i[c+2]];break;case 10:if(!this.images[i[c+2]])break;this.ctx.drawImage(this.images[i[c+2]],i[c+3],i[c+4],i[c+5],i[c+6],i[c+7],i[c+8],i[c+9],i[c+10]);break;case 11:this.ctx.ellipse(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6],i[c+7],i[c+8],1===i[c+9]);break;case 12:this.ctx.fill(e[i[c+2]]);break;case 13:this.ctx.fillStyle=this.gradients[i[c+2]];break;case 14:this.ctx.fillStyle=this.patterns[i[c+2]];break;case 15:this.ctx.fillRect(i[c+2],i[c+3],i[c+4],i[c+5]);break;case 16:if(!this.strings.has(i[c+2]))continue;this.ctx.fillStyle=this.strings.get(i[c+2]);break;case 17:if(!this.strings.has(i[c+2]))continue;this.ctx.fillText(this.strings.get(i[c+2]),i[c+3],i[c+4],-1===i[c+5]?void 0:i[c+5]);break;case 18:if(!this.strings.has(i[c+2]))continue;this.ctx.filter=this.strings.get(i[c+2]);break;case 19:if(!this.strings.has(i[c+2]))continue;this.ctx.font=this.strings.get(i[c+2]);break;case 20:this.ctx.globalAlpha=i[c+2];break;case 21:this.ctx.globalCompositeOperation=exports.GlobalCompositeOperationLookup[i[c+2]];break;case 22:this.ctx.imageSmoothingEnabled=1===i[c+2];break;case 23:this.ctx.imageSmoothingQuality=r[i[c+2]];break;case 24:this.ctx.lineCap=a[i[c+2]];break;case 25:this.ctx.setLineDash(this.wasm.getArray(Float64Array,i[c+2]));break;case 26:this.ctx.lineDashOffset=i[c+2];break;case 27:this.ctx.lineJoin=s[i[c+2]];break;case 28:this.ctx.lineTo(i[c+2],i[c+3]);break;case 29:this.ctx.lineWidth=i[c+2];break;case 30:this.ctx.miterLimit=i[c+2];break;case 31:this.ctx.moveTo(i[c+2],i[c+3]);break;case 32:this.ctx.quadraticCurveTo(i[c+2],i[c+3],i[c+4],i[c+5]);break;case 33:this.ctx.rect(i[c+2],i[c+3],i[c+4],i[c+5]);break;case 34:this.ctx.restore();break;case 35:this.ctx.rotate(i[c+2]);break;case 36:this.ctx.save();break;case 37:this.ctx.scale(i[c+2],i[c+3]);break;case 38:this.ctx.setTransform(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6],i[c+7]);break;case 39:this.ctx.shadowBlur=i[c+2];break;case 40:if(!this.strings.has(i[c+2]))continue;this.ctx.shadowColor=this.strings.get(i[c+2]);break;case 41:this.ctx.shadowOffsetX=i[c+2];break;case 42:this.ctx.shadowOffsetY=i[c+2];break;case 47:this.strings.has(i[c+2])||(this.ctx.fillStyle=this.strings.get(i[c+2]));break;case 44:this.ctx.strokeStyle=this.gradients[i[c+2]];break;case 45:this.ctx.strokeStyle=this.patterns[i[c+2]];break;case 49:this.ctx.textAlign=n[i[c+2]];break;case 50:this.ctx.textBaseline=o[i[c+2]];break;case 52:this.ctx.transform(i[c+2],i[c+3],i[c+4],i[c+5],i[c+6],i[c+7]);break;case 51:this.ctx.translate(i[c+2],i[c+3]);break;default:throw new Error("Invalid canvas instruction type: "+i[c])}c+=h}},u.prototype.add_color_stop=function(t,e,i){this.gradients[t].addColorStop(e,this.wasm.getString(i))},u.prototype.create_image=function(t,e){this.load_image(t,e)},u.prototype.create_linear_gradient=function(t,e,i,r,a){this.gradients[t]=this.ctx.createLinearGradient(e,i,r,a)},u.prototype.create_pattern=function(t,e,i){this.patterns[t]=this.ctx.createPattern(this.images[e],l[i])},u.prototype.create_radial_gradient=function(t,e,i,r,a,s,n){this.gradients[t]=this.ctx.createRadialGradient(e,i,r,a,s,n)},u.prototype.create_string=function(t,e){this.strings.set(t,this.wasm.getString(e))},u.prototype.remove_image=function(t){this.images[t]=null},u.prototype.remove_pattern=function(t){this.patterns[t]=null},u.prototype.remove_gradient=function(t){this.gradients[t]=null},u.prototype.load_image=function(t,e){try{var i=this,r=i.wasm.getString(e);return Promise.resolve(fetch(r)).then(function(e){return Promise.resolve(e.blob()).then(function(e){return Promise.resolve(createImageBitmap(e)).then(function(e){var r=t/Int32Array.BYTES_PER_ELEMENT;i.images[i.wasm.I32[r]]=e,i.wasm.getFunction(i.image_loaded_internal)(t,e.width,e.height)})})})}catch(t){return Promise.reject(t)}},u.prototype.report_inject_function=function(t,e){this.inject_internal=t,this.image_loaded_internal=e},exports.CanvasASInterop=u,exports.canvasPatternTypes=l;
//# sourceMappingURL=canvas-as.js.map
